ğŸ— Final Architecture

We will run:

Nginx (port 80)

PHP-FPM

MySQL 8

phpMyAdmin (port 8081)

No storage volume mount

No permission conflicts

ğŸ“ Final Project Structure
truelysell-laravel-v1/
â”‚
â”œâ”€â”€ Dockerfile
â”œâ”€â”€ docker-compose.yml
â”œâ”€â”€ nginx.conf
â”œâ”€â”€ .env
â”œâ”€â”€ composer.json
â”œâ”€â”€ composer.lock
â””â”€â”€ Laravel files
ğŸ˜ 1ï¸âƒ£ Dockerfile (PHP-FPM)
FROM php:8.4-fpm

RUN apt-get update && apt-get install -y \
    git unzip curl libzip-dev \
    libonig-dev libxml2-dev \
    && docker-php-ext-install pdo_mysql mbstring xml zip bcmath

COPY --from=composer:latest /usr/bin/composer /usr/bin/composer

WORKDIR /var/www/html

COPY . .

RUN composer install --no-interaction --prefer-dist --optimize-autoloader

RUN chown -R www-data:www-data storage bootstrap/cache \
    && chmod -R 775 storage bootstrap/cache

EXPOSE 9000
ğŸŒ 2ï¸âƒ£ nginx.conf

Create file nginx.conf:

server {
    listen 80;
    server_name localhost;

    root /var/www/html/public;
    index index.php index.html;

    location / {
        try_files $uri $uri/ /index.php?$query_string;
    }

    location ~ \.php$ {
        include fastcgi_params;
        fastcgi_pass php:9000;
        fastcgi_index index.php;
        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
    }

    location ~ /\.ht {
        deny all;
    }
}

Important:

fastcgi_pass php:9000;

php = service name.

ğŸ³ 3ï¸âƒ£ Final docker-compose.yml (Clean Version)

ğŸ”¥ No storage mount.
ğŸ”¥ No permission issues.
ğŸ”¥ Proper network.

version: '3.8'

services:

  nginx:
    image: nginx:latest
    container_name: truelysell-nginx
    ports:
      - "80:80"
    volumes:
      - .:/var/www/html
      - ./nginx.conf:/etc/nginx/conf.d/default.conf
    depends_on:
      - php
    networks:
      - app-network

  php:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: truelysell-php
    volumes:
      - .:/var/www/html
    networks:
      - app-network

  mysql:
    image: mysql:8
    container_name: truelysell-mysql
    restart: always
    environment:
      MYSQL_ROOT_PASSWORD: rootpass
      MYSQL_DATABASE: truelysell
      MYSQL_USER: truelyselluser
      MYSQL_PASSWORD: StrongPassword123
    volumes:
      - mysql-data:/var/lib/mysql
    networks:
      - app-network

  phpmyadmin:
    image: phpmyadmin/phpmyadmin
    container_name: truelysell-phpmyadmin
    ports:
      - "8081:80"
    environment:
      PMA_HOST: mysql
    depends_on:
      - mysql
    networks:
      - app-network

volumes:
  mysql-data:

networks:
  app-network:

Notice:

We removed:

./storage:/var/www/html/storage
./bootstrap/cache:/var/www/html/bootstrap/cache

That was your problem.

âš™ 4ï¸âƒ£ Correct .env File

Inside project root:

DB_CONNECTION=mysql
DB_HOST=mysql
DB_PORT=3306
DB_DATABASE=truelysell
DB_USERNAME=truelyselluser
DB_PASSWORD=StrongPassword123

Important:

DB_HOST=mysql

NOT container_name.

ğŸš€ 5ï¸âƒ£ Start Everything Clean

From project folder:

docker-compose down -v
docker-compose up -d --build

Wait 30 seconds.

ğŸ” 6ï¸âƒ£ Generate App Key
docker-compose exec php php artisan key:generate
docker-compose exec php php artisan optimize:clear
ğŸ›¢ 7ï¸âƒ£ Import Database

From project root:

docker exec -i truelysell-mysql \
mysql -u truelyselluser -pStrongPassword123 truelysell < truelysell-laravel-new.sql

Verify:

docker-compose exec mysql mysql -u truelyselluser -pStrongPassword123 -e "USE truelysell; SHOW TABLES;"
ğŸŒ 8ï¸âƒ£ Access Points

Laravel:

http://localhost
